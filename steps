# ARRIA model 10AS027H4F34E3SG

sudo rm -rf a10_example.sdmmc && mkdir a10_example.sdmmc && cd a10_example.sdmmc && export TOP_FOLDER=`pwd`

export QUARTUS_ROOTDIR=/home/ignat/Quartus/Quartus_pro_21_4/quartus

export PATH=$QUARTUS_ROOTDIR/bin:$QUARTUS_ROOTDIR/linux64:$QUARTUS_ROOTDIR/../qsys/bin:$PATH

cd $TOP_FOLDER
rm -rf ghrd-socfpga a10_soc_devkit_ghrd
git clone -b QPDS24.3_REL_GSRD_PR https://github.com/altera-opensource/ghrd-socfpga
mv ghrd-socfpga/a10_soc_devkit_ghrd_pro .
rm -rf ghrd-socfpga
cd a10_soc_devkit_ghrd_pro
make clean && make scrub_clean && rm -rf software
make generate_from_tcl

OK !!! <= с первого раза

ls -alt
total 2016
drwxrwxr-x 6 ignat ignat   4096 Oct  9 16:06 .
-rw-rw-r-- 1 ignat ignat      0 Oct  9 16:06 qsys_generate_qsys
-rw-rw-r-- 1 ignat ignat  16941 Oct  9 16:06 ghrd_10as066n2.qsf
drwxrwxr-x 3 ignat ignat   4096 Oct  9 16:06 qdb
-rw-rw-r-- 1 ignat ignat 609974 Oct  9 16:06 qsys_top.qsys.legacy
-rw-rw-r-- 1 ignat ignat 873115 Oct  9 16:06 qsys_top.qsys
drwxrwxr-x 3 ignat ignat   4096 Oct  9 16:04 ip
-rw-rw-r-- 1 ignat ignat  11689 Oct  9 16:04 ghrd_a10_top.v
-rw-rw-r-- 1 ignat ignat   1330 Oct  9 16:04 ghrd_10as066n2.qpf

make rbf

# установил под Ubuntu Quartus
# пришлось сделать вот это и переустановить заново
sudo apt-get install libncurses6 	<= это и так есть
sudo ln -s /usr/lib/x86_64-linux-gnu/libncursesw.so.6 /usr/lib/x86_64-linux-gnu/libncursesw.so.5
sudo ln -s /usr/lib/x86_64-linux-gnu/libncurses.so.6 /usr/lib/x86_64-linux-gnu/libncurses.so.5



# изменил MAC сетевой карты
sudo ip link set dev enp2s0 down
sudo ip link set dev enp2s0 address 90:2b:34:58:86:b0
sudo ip link set dev enp2s0 up
ifconfig
enp2s0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet6 fe80::a1b7:429:51c:c282  prefixlen 64  scopeid 0x20<link>
        ether 90:2b:34:58:86:b0  txqueuelen 1000  (Ethernet) 			<= OK

# указал в Quartus (tools=>license setup) на файл /media/ignat/Quartus/Q-21_4_dnld_tar/VIK_LICENSE/lic_profitt_902b345886b0.dat
make rbf
OK !!!

ls
construct_subsys_dp.tcl                               fpga_dp.sdc         ip
construct_subsys_jtag_master.tcl                      fpga_niosii.sdc     jtag.sdc
construct_subsys_mixer.tcl                            fpga_pcie.sdc       Makefile
construct_subsys_pcie.tcl                             fpga_pr.sdc         output_files
construct_subsys_peripheral.tcl                       fpga_sgmii.sdc      qdb
construct_subsys_pr_region.tcl                        ghrd_10as066n2.qpf  qsys_generate_qsys
construct_subsys_sgmii.tcl                            ghrd_10as066n2.qsf  qsys_top
construct_subsys_tse.tcl                              ghrd_a10_top.v      qsys_top.qsys
create_ghrd_qsys.tcl                                  ghrd_reset.tcl      qsys_top.qsys.legacy
create_ghrd_quartus.tcl                               ghrd_sc_script.tcl  README.md
create_ghrd_top.tcl                                   ghrd-socfpga        stamp
create_pr_revision.tcl                                ghrd_timing.sdc     tmp-clearbox
custom_ip                                             hps_isw_handoff     top_level_template.v.terp
design_config.tcl                                     hps_sgmii.sdc       update_sysid.tcl
emif_hps_altera_emif_arch_nf_191_nkljffq_summary.csv  intel_custom_ip     utils.tcl


ls output_files
ghrd_10as066n2.asm.rpt           ghrd_10as066n2.fit.route.rpt  ghrd_10as066n2.pin          ghrd_10as066n2.syn.rpt
ghrd_10as066n2.core.rbf          ghrd_10as066n2.fit.rpt        ghrd_10as066n2.sld          ghrd_10as066n2.syn.smsg
ghrd_10as066n2.fit.finalize.rpt  ghrd_10as066n2.fit.summary    ghrd_10as066n2.sof          ghrd_10as066n2.syn.summary
ghrd_10as066n2.fit.place.rpt     ghrd_10as066n2.flow.rpt       ghrd_10as066n2.sta.rpt
ghrd_10as066n2.fit.plan.rpt      ghrd_10as066n2.periph.rbf     ghrd_10as066n2.sta.summary

ls hps_isw_handoff
emif.xml  hps.xml  id



cd $TOP_FOLDER/a10_soc_devkit_ghrd/
mkdir -p software/bootloader
cd software/bootlo
git clone https://github.com/altera-opensource/u-boot-socfpga
cd u-boot-socfpga

git branch
* socfpga_v2025.07

cd $TOP_FOLDER/a10_soc_devkit_ghrd_pro/software/bootloader/u-boot-socfpga

./arch/arm/mach-socfpga/qts-filter-a10.sh \
../../../hps_isw_handoff/hps.xml \
arch/arm/dts/socfpga_arria10_socdk_sdmmc_handoff.h

OK

file arch/arm/dts/socfpga_arria10_socdk_sdmmc_handoff.h
arch/arm/dts/socfpga_arria10_socdk_sdmmc_handoff.h: C source, ASCII text

cd $TOP_FOLDER/a10_soc_devkit_ghrd/software/bootloader/u-boot-socfpga
export CROSS_COMPILE=arm-none-linux-gnueabihf-
make socfpga_arria10_defconfig
make -j 48



cd $TOP_FOLDER/a10_soc_devkit_ghrd/software/bootloader/u-boot-socfpga
ln -s ../../../output_files/ghrd_10as066n2.core.rbf .
ln -s ../../../output_files/ghrd_10as066n2.periph.rbf .


tools/mkimage -E -f board/altera/arria10-socdk/fit_spl_fpga.its fit_spl_fpga.itb
#error
sh: 1: dtc: not found
sudo apt  install device-tree-compiler


tools/mkimage -E -f board/altera/arria10-socdk/fit_spl_fpga.its fit_spl_fpga.itb

OK !!!
ls | grep fit_spl_fpga.itb
fit_spl_fpga.itb <= OK


03_11
 при исползовании ./u-boot_build_ask.sh следует вводить
 для gsrd
        gsrd_hps_isw_handoff
        gsrd_output_files

для vic
        vic_hps_isw_handoff
        vic_output_files

замечено
для старта spl необходдддимо и достаточно 
u-boot-splx4.sfp в ROW
fit_spl_fpga.itb в boot
разумеется оба из одного проекта
        minicom out:
                U-Boot SPL 2025.07 (Nov 01 2025 - 17:55:14 +0300)                                                                       
                DDRCAL: Success                                                                                                         
                FPGA: Checking FPGA configuration setting ...                                                                           
                FPGA: Start to program core bitstream ...                                                                               
                fpgamgr_program_poll_usermode: mess from u-boot-socfpga/*/*/socfpga_arria10.c:405 Failed to enter user mode with error 0
                FPGA: Poll usermode failed with error code -110                                                                         
                Trying to boot from MMC1                                                                                                
                spl_load_image_fat: error reading image u-boot.img, err - -5                                                            
                Error: -2                                                                                                               
                SPL: failed to boot from all boot devices                                                                               
                ### ERROR ### Please RESET the board ###   

если cp u-boot.img в boot sd карты (любой u-boot.img) то стартует как обычно


с 1 по 4 ноября переделал скрипты ask и fast
создал u-boot-socfpga_v2025.07_a10_only
в нем оставил:
ls u-boot-socfpga_v2025.07_a10_only/board
                                                altera        
ls u-boot-socfpga_v2025.07_a10_only/arch/arm
                                                mach-socfpga

ls u-boot-socfpga_v2025.07_a10_only/arch/arm/dts
                                                socfpga_ ....  <= only total 88

через vscode закоментил все ссылки во всех Kconfig типа
source "board..."
source "arch/arm/mach *"

кое-что забыл
cp ~/mach//arm/dts/Makefile u-boot-socfpga_v2025.07_a10_only/arch/arm/dts

Boot options > Boot media  Support for booting from SD/EMMC
Boot options > Autoboot options Show a menu on boot
SPL configuration options Support returning to the BOOTROM
Device Drivers > Watchdog Timer Support (25000) Watchdog timeout in msec

Command line interface > Device access commands lsblk  
                                                clk
                                                MBR
OK log_lsblk_clk_MBR
Command line interface > Memory commands meminfo (with memory map)
                                         memtest

Command line interface > Device access commands Enable support for reading card registers


назначение адресов
arch/arm/mach-socfpga/include/mach/base_addr_a10.h

рабочие файлы
arch/arm/dts/socfpga.dtsi <= mmc: dwmmc0@ff704000 {
arch/arm/dts/socfpga_arria10.dtsi <= mmc: dwmmc0@ff808000 {

попытался удалить все, не относящееся к а10 из arch/arm/dts <= u-boot перестал собираться
подменил periph при сборке mkimage на вариант gsrd <= увы не стартует
подменил core при сборке mkimage на вариант gsrd <= стартует, log тот же самый mmc part увы
скачал gsrd-console-image-arria10.wic записал посредством etcher на sd 
partions в другом порядке
разумеется не загружается
перезаписал в raw свой вариант u-boot-splx4.sfp <= не загружается
заменил fit_spl_fpga.itb в BOOT области <= загрузился, лог несколько иной (u_boot.img из gsrd) в основном без изменений

в gsrd произвел 29 замен вхождений 10AS066N3F40E2SG на 10AS027H4F34E3SG
проект сгенерирован

все переделал, т.к. запутался с редакцией tcl скриптов под использование чипа 10AS027H4F34E3SG
в основном flow создал два каталога
gsrd_native <= из git clone -b QPDS24.3_REL_GSRD_PR https://github.com/altera-opensource/ghrd-socfpga
gsrd_edited <= относительно gsrd_native три замены вхождений 10AS066N3F40E2SG на 10AS027H4F34E3SG
        1 gsrd_edited/design_config.tcl:18
                set FPGA_DEVICE 10AS027H4F34E3SG
        2 gsrd_edited/Makefile:89
                QUARTUS_DEVICE ?= 10AS027H4F34E3SG
        3 gsrd_edited/custom_ip/diffin/construct_diffin.tcl:15
                set FPGA_DEVICE 10AS027H4F34E3SG
